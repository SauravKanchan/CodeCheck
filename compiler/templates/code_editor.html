{% extends 'base.html' %}

{% block content %}
<style type="text/css" media="screen">
    #editor {
        position: absolute;
        top: 0;
        right: 50%;
        bottom: 0;
        left: 0;
    }
</style>


{% include "includes/editor.html" %}


{% load static %}
<script src="{% static 'compiler/src-min/ace.js' %}" type="text/javascript" charset="utf-8"></script>


<script>
    var editor = ace.edit("editor");
    editor.setTheme("ace/theme/monokai");
    editor.getSession().setMode("ace/mode/c_cpp");


    $("#language").change(function () {
        var l =($("select option:selected").text());
        if (l=="python" || l=="python3")
            {editor.getSession().setMode("ace/mode/python");}
        else if (l=="c"){
            editor.getSession().setMode("ace/mode/c_cpp");
        }
        else{
            editor.getSession().setMode("ace/mode/"+l);
        }


    });

    // toggles testcases box   
     $('#custom-input-checkbox').click(function () {

        $("#testcases").slideToggle();

    });  
     
    $(document).on("submit","#data" ,function (e) {
            e.preventDefault();
            $("#output").html("Submitting..");
            // disable submit btn 
            $("#btn").prop('disabled', true)
        $.ajax(
            {
                type: "POST",
                url : "{% url 'result' %}",
                data: {

                    source: editor.getValue(),
                    lang: $("select option:selected").text(),
                    testcases:$("#testcases").val(),
                    csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val(),

                },


                success: function (output) {
                    // enables submit btn
                    $("#btn").prop('disabled', false)
                    var str = (output.output).toString();
                     str=decodeURIComponent(escape(str));
                 $("#output").html(str);
                },

                error:function (err) {
                    // enables submit btn
                    $("#btn").prop('disabled', false)
                    $("#output").html("Something went wrong please try again");
                },
            })


    })


</script>
{% endblock %}